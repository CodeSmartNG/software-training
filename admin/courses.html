<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Courses - Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar (Same as dashboard.html) -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <img src="../logo.png" alt="Logo">
            <h3>CodeSmart NG</h3>
            <p>Admin Panel</p>
        </div>
        
        <nav class="sidebar-nav">
            <a href="dashboard.html">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="courses.html" class="active">
                <i class="fas fa-graduation-cap"></i> Courses
            </a>
            <a href="events.html">
                <i class="fas fa-calendar-alt"></i> Events & Blog
            </a>
            <a href="students.html">
                <i class="fas fa-users"></i> Students
            </a>
            <a href="#" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <p>© 2025 CodeSmart NG</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <header class="top-bar">
            <div class="top-bar-left">
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Manage Courses</h1>
            </div>
            <div class="top-bar-right">
                <button class="btn-primary" onclick="showAddCourseForm()">
                    <i class="fas fa-plus"></i> Add New Course
                </button>
            </div>
        </header>
        
        <!-- Course List Table -->
        <div class="content-section">
            <div class="section-header">
                <h2>All Courses</h2>
                <input type="text" id="courseSearch" placeholder="Search courses..." onkeyup="searchCourses()">
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Course Name</th>
                            <th>Category</th>
                            <th>Duration</th>
                            <th>Fee (₦)</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="coursesTable">
                        <!-- Courses will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Course Modal -->
    <div class="modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Course</h2>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="courseForm" enctype="multipart/form-data">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Course Name *</label>
                        <input type="text" id="courseName" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="courseCategory" required>
                            <option value="">Select Category</option>
                            <option value="frontend">Frontend Development</option>
                            <option value="backend">Backend Development</option>
                            <option value="fullstack">Full Stack Development</option>
                            <option value="basics">Computer Basics</option>
                            <option value="mobile">Mobile Development</option>
                            <option value="data">Data Science</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Duration *</label>
                        <input type="text" id="courseDuration" placeholder="e.g., 3 Months" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Fee (₦) *</label>
                        <input type="number" id="courseFee" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Language *</label>
                        <select id="courseLanguage" required>
                            <option value="en">English Only</option>
                            <option value="ha">Hausa Only</option>
                            <option value="both">English & Hausa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Status</label>
                        <select id="courseStatus">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="upcoming">Upcoming</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Description *</label>
                        <textarea id="courseDescription" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>What You'll Learn (comma separated)</label>
                        <textarea id="courseLearn" rows="2" placeholder="HTML basics, CSS styling, JavaScript functions..."></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Prerequisites (comma separated)</label>
                        <textarea id="coursePrerequisites" rows="2" placeholder="Basic computer knowledge, Internet access..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Course Image</label>
                        <input type="file" id="courseImage" accept="image/*">
                        <div class="image-preview" id="imagePreview"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>Outline PDF</label>
                        <input type="file" id="courseOutline" accept=".pdf">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Course</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="admin.js"></script>
    <script>
        // Check login
        if(localStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }
        
        let editingCourseId = null;
        
        // Load courses on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCourses();
            
            // Check if add action is requested
            const urlParams = new URLSearchParams(window.location.search);
            if(urlParams.get('action') === 'add') {
                showAddCourseForm();
            }
        });
        
        function loadCourses() {
            fetch('../data/courses.json')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('coursesTable');
                    tableBody.innerHTML = '';
                    
                    data.courses.forEach(course => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${course.id}</td>
                            <td>
                                <div class="course-info">
                                    ${course.image ? `<img src="../uploads/${course.image}" alt="${course.name}">` : ''}
                                    <div>
                                        <strong>${course.name}</strong>
                                        <small>${course.description.substring(0, 50)}...</small>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge badge-${course.category}">${course.category}</span></td>
                            <td>${course.duration}</td>
                            <td>₦${course.fee.toLocaleString()}</td>
                            <td><span class="status status-${course.status}">${course.status}</span></td>
                            <td>
                                <button class="btn-icon" onclick="editCourse(${course.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-danger" onclick="deleteCourse(${course.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="btn-icon btn-info" onclick="viewCourse(${course.id})" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading courses:', error);
                    document.getElementById('coursesTable').innerHTML = `
                        <tr><td colspan="7" class="text-center">Failed to load courses. Please check console.</td></tr>
                    `;
                });
        }
        
        function showAddCourseForm() {
            editingCourseId = null;
            document.getElementById('modalTitle').textContent = 'Add New Course';
            document.getElementById('courseForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('courseModal').style.display = 'block';
        }
        
        function editCourse(id) {
            fetch('../data/courses.json')
                .then(response => response.json())
                .then(data => {
                    const course = data.courses.find(c => c.id === id);
                    if(course) {
                        editingCourseId = id;
                        document.getElementById('modalTitle').textContent = 'Edit Course';
                        
                        // Fill form with course data
                        document.getElementById('courseName').value = course.name;
                        document.getElementById('courseCategory').value = course.category;
                        document.getElementById('courseDuration').value = course.duration;
                        document.getElementById('courseFee').value = course.fee;
                        document.getElementById('courseLanguage').value = course.language;
                        document.getElementById('courseStatus').value = course.status;
                        document.getElementById('courseDescription').value = course.description;
                        document.getElementById('courseLearn').value = course.learn?.join(', ') || '';
                        document.getElementById('coursePrerequisites').value = course.prerequisites?.join(', ') || '';
                        
                        // Show image preview if exists
                        if(course.image) {
                            document.getElementById('imagePreview').innerHTML = `
                                <img src="../uploads/${course.image}" alt="Current image" style="max-width: 100px;">
                                <p>Current: ${course.image}</p>
                            `;
                        }
                        
                        document.getElementById('courseModal').style.display = 'block';
                    }
                });
        }
        
        function viewCourse(id) {
            alert(`Viewing course ${id} - This would open a preview page.`);
        }
        
        function deleteCourse(id) {
            if(confirm('Are you sure you want to delete this course?')) {
                fetch('../data/courses.json')
                    .then(response => response.json())
                    .then(data => {
                        data.courses = data.courses.filter(c => c.id !== id);
                        // In a real app, you would save this back to the server
                        console.log('Course deleted:', id);
                        alert('Course deleted successfully!');
                        loadCourses();
                    });
            }
        }
        
        function searchCourses() {
            const searchTerm = document.getElementById('courseSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#coursesTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        function closeModal() {
            document.getElementById('courseModal').style.display = 'none';
        }
        
        // Handle form submission
        document.getElementById('courseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const courseData = {
                id: editingCourseId || Date.now(), // Generate ID if new
                name: document.getElementById('courseName').value,
                category: document.getElementById('courseCategory').value,
                duration: document.getElementById('courseDuration').value,
                fee: parseInt(document.getElementById('courseFee').value),
                language: document.getElementById('courseLanguage').value,
                status: document.getElementById('courseStatus').value,
                description: document.getElementById('courseDescription').value,
                learn: document.getElementById('courseLearn').value.split(',').map(item => item.trim()).filter(Boolean),
                prerequisites: document.getElementById('coursePrerequisites').value.split(',').map(item => item.trim()).filter(Boolean),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Handle file uploads (simplified - in real app, upload to server)
            const imageFile = document.getElementById('courseImage').files[0];
            const outlineFile = document.getElementById('courseOutline').files[0];
            
            if(imageFile) {
                // Simulate file name
                courseData.image = imageFile.name;
            }
            
            if(outlineFile) {
                courseData.outline = outlineFile.name;
            }
            
            // Save course (in real app, send to backend API)
            console.log('Saving course:', courseData);
            
            // Simulate save
            setTimeout(() => {
                alert(editingCourseId ? 'Course updated successfully!' : 'Course added successfully!');
                closeModal();
                loadCourses();
            }, 500);
        });
        
        // Image preview
        document.getElementById('courseImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${e.target.result}" alt="Preview" style="max-width: 200px; border-radius: 5px;">
                    `;
                };
                reader.readAsDataURL(file);
            }
        });
        
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminUser');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
